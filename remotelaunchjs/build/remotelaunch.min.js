var REMOTELAUNCH=REMOTELAUNCH||{REVISION:"1.0.0"};REMOTELAUNCH.Client=function(a,b){var c=this;a=a||{};var d,e=a.ros,f=a.serverName||"/remote_launch_server",g=a.topic||"/list_launch_files",h="/remote_launch_server/RemoteLaunchFileArray",i=new ROSLIB.Topic({ros:e,name:f+g,messageType:h});this.eventEmitter=new EventEmitter2,i.subscribe(function(a){if(c.listCreated)for(d=0;d<a.rlf_array.length;d++)c.list[d].running=a.rlf_array[d].running;else{for(c.list=[],d=0;d<a.rlf_array.length;d++){var b=a.rlf_array[d],g=new REMOTELAUNCH.File({ros:e,serverName:f,id:b.id,name:b.name,wd:b.working_directory,cmd:b.command,running:b.running,inputIdPrefix:"buttonInput"});b.running&&c.eventEmitter.emit("fileStart",b.name),c.list.push(g)}c.listCreated=!0}c.eventEmitter.emit("list_update")}),this.handleFileClick=function(a,b){var d=c.list[a];d.isRunning()===!1?(d.start(),c.eventEmitter.emit("fileStart",b)):(d.stop(),c.eventEmitter.emit("fileStop",b))}},REMOTELAUNCH.File=function(a){var b=this;a=a||{};var c=a.ros,d=a.serverName||"/remote_launch_server",e=a.inputIdPrefix||"buttonInput";this.id=a.id,this.name=a.name,this.wd=a.wd,this.command=a.cmd,this.running=a.running;var f=new ROSLIB.Service({ros:c,name:d+"/StartLaunchFile",serviceType:"remote_launch_server/StartLaunchFile"}),g=new ROSLIB.Service({ros:c,name:d+"/StopLaunchFile",serviceType:"remote_launch_server/StopLaunchFile"});this.isRunning=function(){return this.running},this.buildStartRequest=function(){var a={rlf:{id:b.id,name:b.name,command:b.command,working_directory:b.wd,running:b.running},args:b.args};return a},this.buildStopRequest=function(){var a={rlf:{id:b.id,name:b.name,command:b.command,working_directory:b.wd,running:b.running}};return a},this.start=function(){var a=document.getElementById(e+b.id);b.args=a?a.value:"",f.callService(this.buildStartRequest())},this.stop=function(){g.callService(this.buildStopRequest())}},REMOTELAUNCH.ListInteract=function(a){var b=this;a=a||{},this.canvas=a.canvas;var c=a.inputDiv,d=a.tooltipsDiv,e=a.tooltipsList,f=a.onlyThese;this.client=a.client;var g,h=a.scale||1,i=a.numberOfColumns||3,j="buttonInput";this.buttonWidth=150,this.buttonHeight=100,this.buttonSpace=10,this.stage=new createjs.Stage(this.canvas),this.stage.scaleX=this.stage.scaleY=h,this.stage.enableMouseOver(20),createjs.Touch.enable(this.stage,!1,!0),this.client.eventEmitter.on("list_update",function(){if(b.graphicsCreated){var a=b.list_interact.length;for(g=0;a>g;g++){var k=b.list_interact[g].id,l=b.client.list[k].isRunning()===!0?"running":"idle";b.list_interact[g].setButtonProperties(l)}}else{var m=new createjs.Container,n=b.client.list,o=n.length,p=f?f.length:o,q=Math.ceil(p/i),r=2,s=i*(b.buttonWidth+b.buttonSpace)-b.buttonSpace+2*r,t=q*(b.buttonHeight+b.buttonSpace)-b.buttonSpace+2*r;document.getElementById(b.canvas).width=s*h,document.getElementById(b.canvas).height=t*h;var u={x:r,y:r},v={x:u.x,y:u.y},w=0;for(b.list_interact=[],g=0;o>g;g++)if(!f||-1!==f.indexOf(n[g].id)){var x=e?e[n[g].name]:{},y=new REMOTELAUNCH.FileInteract({stage:b.stage,coords:v,inputDiv:c,tooltipsDiv:d,tooltip:x,id:n[g].id,name:n[g].name,state:n[g].isRunning()===!0?"running":"idle",width:b.buttonWidth,height:b.buttonHeight,inputIdPrefix:j});y.eventEmitter.on("click",b.client.handleFileClick),b.list_interact.push(y),m.addChild(y.button),w++,w===i?(v.y+=b.buttonHeight+b.buttonSpace,v.x=u.x,w=0):v.x+=b.buttonWidth+b.buttonSpace}b.stage.addChild(m),b.graphicsCreated=!0}b.stage.update()})},REMOTELAUNCH.FileInteract=function(a){var b=this;a=a||{},this.id=a.id,this.state=a.state,this.clickedOneTime=!1;var c=a.inputDiv,d=a.tooltipsDiv,e=a.tooltip,f=a.coords,g=a.inputIdPrefix||"buttonInput";this.setButtonProperties=function(a){var c=this.buttonState;this.buttonBackground;switch(a){case"running":c.text="Running",c.font="16px Arial",c.color="#00CC00";break;case"idle":b.clickedOneTime===!1?(c.text="Idle",c.font="16px Arial",c.color="#576357"):(c.text="Stopped",c.font="16px Arial",c.color="#C33627")}},this.eventEmitter=new EventEmitter2;var h=["#d0d8d0","#c8c9c8"],i=0,j=0,k="#FFFFFF",l="#333333";this.button=new createjs.Container,this.button.name="button"+a.id,this.button.x=f.x,this.button.y=f.y,this.button.stage=a.stage,this.buttonBackground=new createjs.Shape,this.buttonBackground.name="background",this.buttonBackground.graphics.beginLinearGradientFill(h,[0,.8],a.width/2,a.height/2,a.width/2,a.height),this.buttonBackground.graphics.drawRoundRect(0,0,a.width,a.height,15),this.buttonBackground.shadow=new createjs.Shadow(k,i,i,2),this.buttonName=new createjs.Text(a.name,"Bold 18px Arial","#000000"),this.buttonName.name="name",this.buttonName.textAlign="center",this.buttonName.textBaseline="middle",this.buttonName.x=a.width/2,this.buttonName.y=1*a.height/4,this.buttonName.maxWidth=a.width,this.buttonState=new createjs.Text,this.buttonState.name="state",this.buttonState.textAlign="center",this.buttonState.textBaseline="middle",this.buttonState.x=a.width/2,this.buttonState.y=2*a.height/4,c&&(this.buttonInput=document.createElement("input"),this.buttonInput.setAttribute("type","text"),this.buttonInput.setAttribute("name",g+b.id),this.buttonInput.setAttribute("id",g+b.id),this.buttonInput.setAttribute("placeholder","args"),this.buttonInput.style.top=f.y+2*a.height/3+"px",this.buttonInput.style.left=f.x+1*a.width/6-2+"px",this.buttonInput.style.opacity="0.4",this.buttonInput.style.width=2*a.width/3+"px",this.buttonInput.style.position="absolute",document.getElementById(c).appendChild(this.buttonInput)),this.button.addChild(this.buttonBackground,this.buttonName,this.buttonState),this.setButtonProperties(a.state),this.button.addEventListener("mousedown",function(){b.buttonBackground.shadow.offsetX=j,b.buttonBackground.shadow.offsetY=j,b.buttonBackground.shadow.color=l,b.button.stage.update()}),this.button.addEventListener("pressup",function(){b.buttonBackground.shadow.offsetX=i,b.buttonBackground.shadow.offsetY=i,b.buttonBackground.shadow.color=k,b.button.stage.update()}),this.button.addEventListener("click",function(){b.clickedOneTime=!0,b.eventEmitter.emit("click",b.id,a.name)}),d&&(this.tooltipsDOM=document.getElementById(d),this.tooltipsSpanDOM=this.tooltipsDOM.firstElementChild||this.tooltipsDOM.firstChild,this.button.addEventListener("mouseover",function(){b.tooltipsSpanDOM.textContent=e,b.tooltipsDOM.style.display="block",b.button.stage.update()}),this.button.addEventListener("mouseout",function(){b.tooltipsDOM.style.display="none",b.button.stage.update()}))};